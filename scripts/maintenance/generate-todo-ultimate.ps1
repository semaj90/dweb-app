# Ultimate TODO Generation Script for SvelteKit
# This script runs npm run check and generates a formatted TODO.md file

Write-Host "ğŸš€ SvelteKit TODO Generation System" -ForegroundColor Cyan
Write-Host "======================================" -ForegroundColor Cyan
Write-Host ""

# Change to sveltekit-frontend directory
Set-Location "sveltekit-frontend"

Write-Host "ğŸ“ Current directory: $(Get-Location)" -ForegroundColor Yellow
Write-Host "ğŸ”„ Running project checks..." -ForegroundColor Yellow

# Variables
$ErrorFile = "check-errors.log"
$OutputFile = "TODO.md"
$timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"

# Run npm run check and capture output
try {
    $output = npm run check 2>&1
    $output | Out-File -FilePath $ErrorFile -Encoding UTF8
    Write-Host "âœ… Check completed successfully!" -ForegroundColor Green
} catch {
    Write-Host "âš ï¸ Check completed with issues" -ForegroundColor Yellow
    $_.Exception.Message | Out-File -FilePath $ErrorFile -Encoding UTF8
}

# Create comprehensive TODO.md
$todoContent = @"
# âœ… Project Issues Todo List

Generated on $timestamp

## Summary
This file contains all TypeScript, Svelte, and other issues found by running ``npm run check``.

## Check Results
"@

# Analyze the output
$logContent = Get-Content $ErrorFile -ErrorAction SilentlyContinue
$issueCount = 0
$fileIssues = @{}

if ($logContent) {
    foreach ($line in $logContent) {
        # Look for file paths and errors
        if ($line -match "src[/\\].*") {
            $currentFile = ($line -split ":")[0]
            if ($currentFile -match "src[/\\].*") {
                $currentFile = [regex]::Match($currentFile, "src[/\\].*").Value
            }
        }
        
        if ($line -match "(error|warning|Error|Warning)" -and $currentFile) {
            if (-not $fileIssues.ContainsKey($currentFile)) {
                $fileIssues[$currentFile] = @()
            }
            $cleanLine = $line -replace "^.*?:", ""
            $fileIssues[$currentFile] += $cleanLine.Trim()
            $issueCount++
        }
    }
}

# Add results to TODO
if ($issueCount -gt 0) {
    $todoContent += "`nğŸ” Found **$issueCount** issues that need attention:`n"
    foreach ($file in $fileIssues.Keys) {
        $todoContent += "`n### ğŸ“„ File: ``$file```n"
        foreach ($issue in $fileIssues[$file]) {
            $todoContent += "- âŒ $issue`n"
        }
    }
} else {
    $todoContent += "`nâœ… **No issues found!** Your project is clean and ready to go!`n"
}

# Add modern components section
$todoContent += @"

---

## ğŸ¨ Modern SvelteKit Components Available

Your project includes these cutting-edge components:

### ğŸ¯ Command System
- **CommandMenu.svelte** - Slash command system with citations
- **SmartTextarea.svelte** - Textarea with integrated command menu

### ğŸ¨ Layout Components  
- **GoldenLayout.svelte** - Golden ratio layout with collapsible sidebar
- **ExpandGrid.svelte** - Hover-expanding grid (1â†’3 columns)

### ğŸ”§ Enhanced Components
- **EvidenceCard.svelte** - Improved hover effects and accessibility
- **Citations Store** - Full CRUD with recent citations tracking
- **Fast Navigation** - SvelteKit's built-in SPA routing

### ğŸ“± Features
- âœ¨ **Hover Effects** - Scale animations and smooth transitions
- ğŸ¨ **Type-specific Styling** - Color-coded badges and themes
- ğŸ“± **Responsive Design** - Mobile-first approach
- â™¿ **Accessibility** - Screen reader friendly with ARIA labels
- ğŸ¯ **Interactive Actions** - Comprehensive button system
- ğŸ·ï¸ **Smart Metadata** - File information and formatting
- ğŸ”— **Preview Support** - Image and video previews
- ğŸ“ **Tooltip System** - Detailed information on hover

## ğŸ® Demo Page
Visit ``/modern-demo`` to see all components in action!

## ğŸš€ Next Steps
1. ğŸ§ª Test the demo page at ``/modern-demo``
2. ğŸ”— Integrate components into your existing pages
3. ğŸ¨ Customize styling with CSS custom properties
4. âš¡ Add more commands to the command menu
5. ğŸ”„ Run this script regularly to track progress

## ğŸ› ï¸ Development Commands
```bash
# Run checks
npm run check

# Generate TODO
powershell -ExecutionPolicy Bypass -File ../generate-todo-ultimate.ps1

# Start development
npm run dev
```

---

**Generated by:** SvelteKit Modernization & Automation System  
**Last Updated:** $timestamp
"@

# Write the TODO file
$todoContent | Out-File -FilePath $OutputFile -Encoding UTF8

Write-Host ""
Write-Host "ğŸ‰ SUCCESS! TODO.md has been generated!" -ForegroundColor Green
Write-Host "ğŸ“‹ Location: $(Get-Location)\$OutputFile" -ForegroundColor Cyan
Write-Host ""

# Display summary
Write-Host "ğŸ“Š Summary:" -ForegroundColor Yellow
if ($issueCount -gt 0) {
    Write-Host "   âš ï¸  $issueCount issues found" -ForegroundColor Red
} else {
    Write-Host "   âœ… No issues found - project is clean!" -ForegroundColor Green
}

Write-Host "   ğŸ“„ TODO.md updated with latest status" -ForegroundColor Cyan
Write-Host "   ğŸ¨ Modern components documented" -ForegroundColor Magenta
Write-Host ""
Write-Host "ğŸ¯ Next: Visit http://localhost:5173/modern-demo to see your modern components!" -ForegroundColor Cyan
